<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gerenciador de Presentes - Ch√° de Beb√™</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
    /* Estilos aplicados apenas quando o item est√° reservado */
.pack-item.reservado {
    background-color: #f1f9f4;
    border-color: #A9DFBF;
    cursor: default;
    opacity: 0.8; /* Deixa o card levemente transparente */
    padding: 10px; /* Reduz o espa√ßamento interno */
}

.reservado .numero-circulo {
    background-color: var(--verde-sucesso);
    width: 25px;  /* Reduz o c√≠rculo do n√∫mero */
    height: 25px;
    font-size: 12px;
}

.reservado .produto {
    font-size: 12px; /* Fonte menor para o nome do produto */
    color: #777;     /* Cor de texto mais suave */
}

.reservado .info-reserva {
    margin-top: 5px;
    padding-top: 5px;
    font-size: 11px; /* Fonte menor para o texto "Reservado por" */
}
        :root {
            --azul-fundo: #E6F3FA;
            --azul-primario: #5DADE2;
            --azul-claro: #D6EAF8;
            --branco: #FFFFFF;
            --verde-sucesso: #27AE60;
        }

        body {
            margin: 0;
            padding: 15px;
            background-color: var(--azul-fundo);
            font-family: 'Nunito', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* --- CAMADA DE FUNDO ANIMADO --- */
        #ursinhos-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }

        .elemento-flutuante {
            position: absolute;
            bottom: -50px;
            font-size: 24px;
            opacity: 0.4;
            animation: subir linear infinite;
        }

        @keyframes subir {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.4; }
            90% { opacity: 0.4; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--azul-fundo); display: flex;
            justify-content: center; align-items: center; z-index: 1000;
            transition: opacity 0.8s ease, visibility 0.8s;
        }
        .splash-content { text-align: center; animation: fadeInScale 1.2s ease-out; }
        .splash-icon { font-size: 80px; margin-bottom: 10px; }
        .splash-text { font-family: 'Fredoka', sans-serif; color: var(--azul-primario); font-size: 28px; }
        .heart-loader { font-size: 30px; animation: pulse 1.5s infinite; margin-top: 15px; }
        @keyframes fadeInScale { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
        .hidden-splash { opacity: 0 !important; visibility: hidden !important; }

        /* Layout Principal */
        .folha-a4 {
            background-color: rgba(255, 255, 255, 0.9);
            max-width: 900px; margin: 0 auto;
            padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); min-height: 90vh;
            position: relative; z-index: 1;
        }
        header { text-align: center; margin-bottom: 25px; border-bottom: 2px dotted var(--azul-claro); padding-bottom: 15px; }
        h1 { font-family: 'Fredoka', sans-serif; color: var(--azul-primario); margin: 0; font-size: 24px; }
        
        .lista-grid { display: grid; grid-template-columns: 1fr; gap: 12px; opacity: 0; transition: opacity 0.5s ease-in; }
        .lista-grid.loaded { opacity: 1; }
        @media (min-width: 600px) { .lista-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); } }

        .pack-item { background-color: #fcfdfe; border: 2px solid var(--azul-claro); border-radius: 12px; padding: 15px; cursor: pointer; transition: 0.2s; }
        .pack-item.reservado { background-color: #f1f9f4; border-color: #A9DFBF; cursor: default; }
        .numero-circulo { background-color: var(--azul-primario); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-bottom: 8px; }
        .reservado .numero-circulo { background-color: var(--verde-sucesso); }
        .produto { font-size: 14px; color: #444; line-height: 1.4; }
        .produto::before { content: "üß∏"; margin-right: 8px; }
        .info-reserva { margin-top: 10px; padding-top: 8px; border-top: 1px solid #e8f5e9; font-size: 13px; color: var(--verde-sucesso); font-weight: bold; }

        #btnAdicionar { position: fixed; bottom: 25px; right: 25px; background-color: var(--azul-primario); color: white; border: none; border-radius: 50%; width: 55px; height: 55px; font-size: 30px; cursor: pointer; z-index: 99; display: flex; align-items: center; justify-content: center; opacity: 0.8; transition: 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        #controleSom { position: fixed; bottom: 25px; left: 25px; background: var(--branco); border: 2px solid var(--azul-claro); border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 99; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 20px; }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        .modal { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; }
        input { width: 100%; padding: 14px; margin: 10px 0; border: 2px solid var(--azul-claro); border-radius: 12px; font-size: 16px; }
        .btn-save { background-color: var(--azul-primario); color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; }
        .btn-cancel { display: block; margin: 15px auto 0; background: none; border: none; color: #888; cursor: pointer; text-decoration: underline; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--azul-primario); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-right: 8px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="ursinhos-bg"></div>

<audio id="musicaFundo" loop>
    <source id="audioSource" src="" type="audio/mpeg">
</audio>

<div id="splash-screen">
    <div class="splash-content">
        <div class="splash-icon">üß∏</div>
        <h2 class="splash-text">Seja bem-vindo(a)!</h2>
        <div class="heart-loader">‚ù§Ô∏è</div>
    </div>
</div>

<div class="folha-a4">
    <header>
        <h1>Gerenciador de Presentes üß∏</h1>
        <p>Escolha um item para presentear.</p>
    </header>
    <div id="gridPacks" class="lista-grid"></div>
</div>

<button id="btnAdicionar" onclick="adicionarNovoPack()">+</button>
<div id="controleSom">üîà</div>

<div id="modalOverlay" class="modal-overlay">
    <div class="modal">
        <h2 id="modalTitle" style="color: var(--azul-primario); font-family: 'Fredoka';">Reservar</h2>
        <input type="text" id="inputNome" placeholder="Seu Nome Completo">
        <input type="tel" id="inputTelefone" placeholder="Telefone com DDD" inputmode="numeric">
        <button id="btnConfirmar" class="btn-save" onclick="salvarReserva()">Confirmar Reserva</button>
        <button class="btn-cancel" onclick="fecharModal()">Voltar</button>
    </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx467Yfxcfg_XjJ3_rUoLJklLjH_g1TxOv7VrvBEDZbXz72jqqQSc8B4a7vEjoqs80K/exec";
const musica = document.getElementById('musicaFundo');
const audioSource = document.getElementById('audioSource');
const btnSom = document.getElementById('controleSom');
let packSelecionadoId = null;

const playlist = ['musica1.mp3', 'musica2.mp3', 'musica3.mp3'];

function configurarMusicaAleatoria() {
    const escolhida = playlist[Math.floor(Math.random() * playlist.length)];
    audioSource.src = escolhida;
    musica.load();
}

function iniciarAnimacaoFundo() {
    const container = document.getElementById('ursinhos-bg');
    const itens = ['üß∏', '‚òÅÔ∏è', '‚ú®', 'üçº', '‚òÅÔ∏è'];
    
    for (let i = 0; i < 15; i++) {
        const elemento = document.createElement('div');
        elemento.className = 'elemento-flutuante';
        elemento.innerText = itens[Math.floor(Math.random() * itens.length)];
        elemento.style.left = Math.random() * 100 + 'vw';
        elemento.style.animationDuration = (Math.random() * 10 + 10) + 's';
        elemento.style.animationDelay = (Math.random() * 10) + 's';
        elemento.style.fontSize = (Math.random() * 20 + 20) + 'px';
        container.appendChild(elemento);
    }
}

window.addEventListener('load', () => {
    configurarMusicaAleatoria();
    iniciarAnimacaoFundo();
    
    setTimeout(() => {
        document.getElementById('splash-screen').classList.add('hidden-splash');
        document.body.addEventListener('click', () => {
            if (musica.paused) {
                musica.play();
                musica.volume = 0.3;
                btnSom.innerHTML = 'üîä';
            }
        }, { once: true });
    }, 3000);  // <--- Mude aqui para mudar tempo do splash
});

btnSom.onclick = (e) => {
    e.stopPropagation();
    if (musica.paused) { musica.play(); btnSom.innerHTML = 'üîä'; }
    else { musica.pause(); btnSom.innerHTML = 'üîà'; }
};

async function carregarDados() {
    const grid = document.getElementById('gridPacks');
    grid.classList.remove('loaded');
    grid.innerHTML = '<div style="text-align:center; grid-column: 1/-1; padding: 40px;"><div class="loader"></div> Carregando lista...</div>';
    
    try {
        const response = await fetch(SCRIPT_URL);
        const rows = await response.json();
        grid.innerHTML = '';
        
        for (let i = 1; i < rows.length; i++) {
            const [id, itens, nome] = rows[i];
            if (!itens) continue;

            const div = document.createElement('div');
            div.className = `pack-item ${nome ? 'reservado' : ''}`;
            if (!nome) div.onclick = () => abrirModal(id);
            
            div.innerHTML = `
                <div class="numero-circulo">${id}</div>
                <div class="produto"><strong>${itens}</strong></div>
                ${nome ? `<div class="info-reserva">‚úÖ Reservado por: ${nome}</div>` : ''}
            `;
            grid.appendChild(div);
        }
        grid.classList.add('loaded');
    } catch (e) {
        grid.innerHTML = '<p style="text-align:center; color:red; padding: 20px;">Erro ao carregar dados.</p>';
    }
}

function abrirModal(id) {
    packSelecionadoId = id;
    document.getElementById('modalTitle').innerText = 'Reservar Item #' + id;
    document.getElementById('modalOverlay').style.display = 'flex';
}

function fecharModal() {
    document.getElementById('modalOverlay').style.display = 'none';
}

async function salvarReserva() {
    const nome = document.getElementById('inputNome').value.trim();
    const tel = document.getElementById('inputTelefone').value.trim();
    const btn = document.getElementById('btnConfirmar');

    if (!nome) return alert("Por favor, digite seu nome.");

    btn.innerHTML = '<div class="loader"></div> Salvando...';
    btn.disabled = true;

    try {
        await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ pack: packSelecionadoId, nome: nome, tel: tel })
        });
        fecharModal();
        alert("Muito obrigado(a), " + nome + "! ‚ù§Ô∏è\nSua reserva foi confirmada.");
        await carregarDados();
    } catch (e) {
        alert("Erro ao salvar.");
    } finally {
        btn.innerHTML = "Confirmar Reserva";
        btn.disabled = false;
    }
}

async function adicionarNovoPack() {
    const senha = prompt("Senha administrativa:");
    if (senha !== "2468") return;
    const desc = prompt("Descri√ß√£o do novo item:");
    if (!desc) return;
    const btn = document.getElementById('btnAdicionar');
    btn.innerText = "‚è≥";
    try {
        const total = document.querySelectorAll('.pack-item').length;
        await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ pack: total + 1, itens: desc })
        });
        location.reload();
    } catch (e) {
        alert("Erro.");
        btn.innerText = "+";
    }
}

carregarDados();
</script>
</body>
</html>
